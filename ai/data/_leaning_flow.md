# 파일 이름 컨벤션

### [꽃이름]\_[순번].jpg

### ex) rose_0001.jpg

- 순번은 총 1만 개까지.

- txt 라벨 파일도 동일한 파일명.

## 0. 이미지 데이터 수집

- `0_crawler.ipynb` 참조

- 고화질 꽃 이미지가 필요하므로, 네이버 이미지 검색 api를 이용해 데이터를 수집한다.

- 꽃당 기본적으로 1000개의 이미지를 수집한다. 추천 검색어는 `{꽃이름} 생화 한 송이`, `생화 {꽃이름}`

- 중복 이미지를 제거한다.

- 이미지와 이미지에 기반해 생성된 txt파일은 모두 `{꽃이름}_{순번}` 컨벤션을 유지하며, 3,5번 폴더를 제외하면 꽃이름을 상세 폴더로 사용한다.

## 1. CV2를 이용한 바운딩 좌표 데이터 생성

- `1_bounder.ipynb` 참조

- `flower` 변수를 반드시 확인하고 유의한다.

- CV2를 이용해 이미지를 띄우고, 두 개의 점을 클릭하여 좌측상단, 우측하단 좌표를 txt파일로 기록한다. 한 이미지 내에서 여러 바운딩을 만들 수 있다.

  - `q` : 생성한 바운딩을 저장하고 다음 사진으로 넘어감,
    바운딩이 없는 경우, 추후에 `모델 바운더`를 이용해 학습할 데이터를 의미한다. 즉, `q`를 누르는 것은 유의미한 데이터임을 표시한 것.
  - `f` : 데이터로써 부적합하므로, 삭제하고 다음 사진으로 넘어감
  - `c` : 현재 이미지에서 생성한 모든 바운딩을 삭제하고, 다시 시작함
  - `p` : 탈출

- 바운딩 생성기를 통해 생성된 좌표 txt 파일은 `1_labels_data`에 저장된다.

- `1번`폴더에 저장된 라벨, 좌표 txt 파일의 이름을 검사하여, `0_flower_data`의 원본 이미지 파일을 `2_learning_img`폴더로 복사한다.

- `2번`폴더의 이미지와 `1번`폴더의 라벨을, 8:2 비율로 train, test set을 나누어 `3_one_time_data`로 이동시킨다.

- `python train.py --img 640 --rect --batch 16 --epoch 50 --data one_data.yaml --cfg one_yolov5m.yalm --weight yolov5m.pt --name {꽃이름}`로 학습시킨다.

- 학습된 모델과 결과는 `yolov5/runs/train/{꽃이름}` 내에서 확인 가능하다. `best.pt` 모델을 `{꽃이름}.pt`로 수정하여 `models`폴더에 저장한다.

## 2. 모델을 통한 데이터 라벨링

- `2_model_learning.ipynb` 참조

- 역시 `flower` 변수 확인, 유의 필

- `1번 과정`을 통해 완성된 모델(모델명은 꽃 이름)을 사용한다.

- 수집한 해당 종류의 꽃 이미지를 모두 모델로 바운딩한다.

- `4_model_images/{꽃이름}` 폴더에 자동으로 프로세싱 이미지가 저장되며, `1번` 폴더의 꽃이름 폴더에 라벨, 바운딩 txt 파일도 저장된다.

  - 이를 이용해 `3번` 폴더로 보내, 새롭게 학습시킬 수도 있다.

- 이후, 위에서 사용한 cv2 바운더 생성기를 통해 추가적으로 바운더를 생성해주거나(이전에 생성된 라벨, 바운딩에 이어서 작성된다.), 폴더에서 그냥 결측치, 이상치를 제거해준다.

- 바운딩이 끝나면, `4번` 폴더에 잔류한 이미지 파일에 따라 `1번` 폴더의 txt파일과 `0번` 폴더의 이미지 파일들을 `5_total_data`에 저장한다.

## 3. 전체 모델 생성

- `python train.py --img 640 --rect --batch 16 --epoch {} --data total_data.yaml --cfg total_yolov5m.yalm --weight yolov5m.pt --name main`로 학습시킨다.

---

### 리뉴얼 이전

# 바운딩 박스 검출 모델 생성

## 1. 데이터를 수집한다.

- scrapper를 통해 구글에서 검색어를 기준으로 사진을 긁어온다.

- 이후 누가 봐도 이상한 사진들은 제거

- 사진 저장 위치 : 0

## 2. opencv로 바운딩 박스를 그리고 그려진 사진들을 다시 수작업으로 분류하여 이상치를 제거

- 작업 위치 : 1

## 3. 0에 존재하며, 1에도 있는 파일을 2로 복사

- 0 - (1참조) -> 2

## 4. 2의 이미지를 증강. 색반전, 노이즈 추가

- 색반전 1개, 노이즈 1개 추가

- 색반전 파일은 `[꽃이름]_[순번]_col.jpg`

- 노이즈 파일은 `[꽃이름]_[순번]_noise.jpg`

## 5. 2의 이미지 중, 원본 이미지에서만 바운딩 좌표 생성 후, 세 개의 txt파일로 저장

- 즉, 한 개의 이미지 파일은 3개의 이미지와 동량의 txt파일로 분화.

## 6. 학습파일로 데이터셋으로 저장해주기

- 테스트 셋 비율은 0.2

- data_set 폴더 내 train, test 폴더들 내부의 image와 labels 폴더에 넣어주기.

## 7. 최초 학습하여 1클래스 탐지 모델 생성

- 모델 명은 `[꽃이름]_bounder.pt`

# 전체 이미지 바운딩 박스 그리기

## 1. 0에 존재하는 모든 이미지에 바운딩 박스 생성

- 바운딩 박스가 그려진 파일은 1에 저장

## 2. 여기서마저 이상한 놈들은 그래도 일단 제거

- 0에도 있고, 1에도 있는 애들만 원본을 2로 보내기

## 3. 데이터 증강시키기.

- 위와 똑같은 플로우

## 4. 3에 있는 애들을 다시 분류하여, data_set으로 만들어주기.

- 기존 데이터셋은 없애기.

### yolo 다운

git clone https://github.com/ultralytics/yolov5.git

###
